(()=>{"use strict";function t(t,e,n){return fetch("https://nomoreparties.co/v1/plus-cohort-9/".concat(t),{method:e,headers:{"Content-Type":"application/json; charset=UTF-8",Authorization:"4aa45065-cf66-4840-9e29-974284b6da3e"},body:JSON.stringify(n)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}var e,n=document.querySelector(".card-img__image"),o=document.querySelector(".card-img__subtitle"),r=document.querySelector(".popup__profile"),c=document.querySelector(".profile__title"),u=document.querySelector(".profile__subtitle"),i=document.forms.popupProfile,a=i.elements.name,s=i.elements.subtitle,l=document.querySelectorAll(".popup");function d(t){"Escape"===t.key&&f(document.querySelector(".popup_opened"))}function f(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",d)}function p(t){t.classList.add("popup_opened"),document.addEventListener("keydown",d)}function m(t,e){e.textContent=t?"".concat(e.id,"..."):"".concat(e.id)}var _=document.querySelector(".card-img"),v=document.querySelector("#card-template").content,y=document.forms.popupCard,S=y.elements.name,b=y.elements.subtitle,h=document.querySelector(".btn-card"),q=document.querySelector(".cards"),k=document.querySelector(".popup__card");function E(r,c,u,i,a,s){var l,f=v.querySelector(".card").cloneNode(!0),m=f.querySelector(".card__img"),y=f.querySelector(".card__delete"),S=f.querySelector(".card__like-number");return S.textContent=a,m.setAttribute("alt",r),m.setAttribute("src",c),m.setAttribute("aria-label",r),f.querySelector(".card__title").textContent=r,function(e,n,o){e.querySelector(".card__like").addEventListener("click",(function(e){e.target.classList.contains("card__like_active")?t("cards/likes/".concat(o),"DELETE").then((function(t){e.target.classList.toggle("card__like_active"),n.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})):t("cards/likes/".concat(o),"PUT").then((function(t){e.target.classList.toggle("card__like_active"),n.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))}))}(f,S,i),l=u,y.style.display=l!=e?"none":"block",function(e,n,o){e.addEventListener("click",(function(){t("cards/".concat(n),"DELETE").then((function(){o.remove()})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))}))}(y,i,f),m.addEventListener("click",(function(){p(_),d(_),function(t,e){n.setAttribute("src",e),n.setAttribute("alt",t),o.textContent=t}(r,c)})),function(t,n){n.forEach((function(n){n._id==e&&t.querySelector(".card__like").classList.add("card__like_active")}))}(f,s),S.textContent=a,f}var L={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__text-button",inactiveButtonClass:"popup__text-button_inactive",inputErrorClass:"popup__text_error",errorClass:"popup__error_active"};function C(t){var e=Array.from(t.querySelectorAll(L.inputSelector)),n=t.querySelector(L.submitButtonSelector);n&&x(e,n,L)}var g,x=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},A=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__avatar"),B=document.querySelector(".popup__profile-icon"),w=document.forms.popupProfileIcon,j=w.elements.subtitle,D=document.querySelector(".btn-profile"),G=document.querySelector(".btn-profile-icon");y.addEventListener("submit",(function(){m(!0,h),t("cards","POST",{link:b.value,name:S.value}).then((function(t){q.prepend(E(t.name,t.link,t.owner._id,t._id,t.likes.length,t.likes)),f(k),y.reset()})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){m(!1,h)}))})),P.addEventListener("click",(function(){p(B),w.reset(),C(w)})),w.addEventListener("submit",(function(){m(!0,G),t("users/me/avatar","PATCH",{avatar:j.value}).then((function(t){return P.style.backgroundImage="url(".concat(j.value,")")})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){m(!1,G),f(B)}))})),t("users/me","GET").then((function(t){P.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})),g=L,Array.from(document.querySelectorAll(g.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);x(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){t.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(r,t,e),x(n,o,e)}))}))}(t,g)})),T.addEventListener("click",(function(){p(k),y.reset(),C(y)})),A.addEventListener("click",(function(){p(r),a.value=c.textContent,s.value=u.textContent})),l.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&f(t),e.target.classList.contains("popup__img")&&f(t)}))})),i.addEventListener("submit",(function(){m(!0,D),t("users/me","PATCH",{name:a.value,about:s.value}).then((function(t){return c.textContent=a.value,u.textContent=s.value,void f(r)})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){return m(!1,D)}))})),Promise.all([void t("users/me","GET").then((function(t){e=t._id,c.textContent=t.name,u.textContent=t.about})),void t("cards","GET").then((function(t){!function(t){for(var e=0;e<t.length;e++)q.append(E(t[e].name,t[e].link,t[e].owner._id,t[e]._id,t[e].likes.length,t[e].likes))}(t)}))]).then((function(t){return console.log(t)})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))})();