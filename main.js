(()=>{"use strict";var t=document.querySelector(".card-img__image"),e=document.querySelector(".card-img__subtitle"),n=document.querySelector(".popup__profile"),o=document.querySelector(".profile__title"),r=document.querySelector(".profile__subtitle"),c=document.forms.popupProfile,u=c.elements.name,a=c.elements.subtitle,i=document.querySelectorAll(".popup");function s(t){"Escape"===t.key&&l(document.querySelector(".popup_opened"))}function l(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",s)}function d(t){t.classList.add("popup_opened"),document.addEventListener("keydown",s)}function f(t,e){e.textContent=t?"".concat(e.id,"..."):"".concat(e.id)}function p(t,e,n){return fetch("https://nomoreparties.co/v1/plus-cohort-9/".concat(t),{method:e,headers:{"Content-Type":"application/json; charset=UTF-8",Authorization:"4aa45065-cf66-4840-9e29-974284b6da3e"},body:JSON.stringify(n)}).then((function(t){if(t.ok)return t.json()})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))}var m=document.querySelector(".card-img"),_=document.querySelector("#card-template").content,v=document.forms.popupCard,y=v.elements.name,S=v.elements.subtitle,b=document.querySelector(".btn-card"),h=document.querySelector(".cards"),q=document.querySelector(".popup__card");function E(n,o,r,c,u,a){var i,l=_.querySelector(".card").cloneNode(!0),f=l.querySelector(".card__img"),v=l.querySelector(".card__delete"),y=l.querySelector(".card__like-number");return y.textContent=u,f.setAttribute("alt",n),f.setAttribute("src",o),f.setAttribute("aria-label",n),l.querySelector(".card__title").textContent=n,function(t,e,n){t.querySelector(".card__like").addEventListener("click",(function(t){t.target.classList.toggle("card__like_active"),t.target.classList.contains("card__like_active")?p("cards/likes/".concat(n),"PUT").then((function(t){e.textContent=t.likes.length})):p("cards/likes/".concat(n),"DELETE").then((function(t){return e.textContent=t.likes.length})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))}))}(l,y,c),i=r,v.style.display="12b8ae712c461ad10ad8a065"!=i?"none":"block",function(t,e,n){t.addEventListener("click",(function(){p("cards/".concat(e),"DELETE").then((function(){n.remove()})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))}))}(v,c,l),f.addEventListener("click",(function(){d(m),s(m),function(n,o){t.setAttribute("src",o),t.setAttribute("alt",n),e.textContent=n}(n,o)})),function(t,e){e.forEach((function(e){"12b8ae712c461ad10ad8a065"==e._id&&t.querySelector(".card__like").classList.add("card__like_active")}))}(l,a),y.textContent=u,l}var k={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__text-button",inactiveButtonClass:"popup__text-button_inactive",inputErrorClass:"popup__text_error",errorClass:"popup__error_active"};function L(t){var e=Array.from(t.querySelectorAll(k.inputSelector)),n=t.querySelector(k.submitButtonSelector);n&&g(e,n,k)}var C,g=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},x=document.querySelector(".profile__edit-button"),A=document.querySelector(".profile__add-button"),T=document.querySelector(".profile__avatar"),B=document.querySelector(".popup__profile-icon"),P=document.forms.popupProfileIcon,w=P.elements.subtitle,D=document.querySelector(".btn-profile"),G=document.querySelector(".btn-profile-icon");v.addEventListener("submit",(function(){f(!0,b),p("cards","POST",{link:S.value,name:y.value}).then((function(t){h.prepend(E(t.name,t.link,t.owner._id,t._id,t.likes.length,t.likes))})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){f(!1,b),l(q),v.reset()}))})),T.addEventListener("click",(function(){d(B),P.reset(),L(P)})),P.addEventListener("submit",(function(){f(!0,G),T.style.backgroundImage="url(".concat(w.value,")"),p("users/me/avatar","PATCH",{avatar:w.value}).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){f(!1,G),l(B)}))})),p("users/me","GET").then((function(t){T.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})),C=k,Array.from(document.querySelectorAll(C.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);g(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){t.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(r,t,e),g(n,o,e)}))}))}(t,C)})),A.addEventListener("click",(function(){d(q),v.reset(),L(v)})),x.addEventListener("click",(function(){d(n),u.value=o.textContent,a.value=r.textContent})),i.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&l(t),e.target.classList.contains("popup__img")&&l(t)}))})),c.addEventListener("submit",(function(){f(!0,D),p("users/me","PATCH",{name:u.value,about:a.value}).catch((function(t){return console.error("Ошибка: ".concat(t.status))})).finally((function(t){return f(!1,D)})),o.textContent=u.value,r.textContent=a.value,l(n)})),p("cards","GET").then((function(t){!function(t){for(var e=0;e<t.length;e++)h.append(E(t[e].name,t[e].link,t[e].owner._id,t[e]._id,t[e].likes.length,t[e].likes))}(t),console.log(t)})).catch((function(t){return console.error("Ошибка: ".concat(t.status))})),p("users/me","GET").then((function(t){o.textContent=t.name,r.textContent=t.about})).catch((function(t){return console.error("Ошибка: ".concat(t.status))}))})();